import sqlite3
from datetime import datetime

DB_PATH = "members.db"  # replace with your actual database file

def format_dates():
    conn = sqlite3.connect(DB_PATH)
    cursor = conn.cursor()

    # Select all IDs and current dates
    cursor.execute("SELECT id, meeting_date FROM meeting_attendance")
    rows = cursor.fetchall()

    for row_id, old_date in rows:
        try:
            # Try parsing the date in a flexible way
            parsed = datetime.strptime(old_date, "%m/%d/%Y")  # example: 12/31/2024
        except ValueError:
            try:
                parsed = datetime.strptime(old_date, "%d-%m-%Y")  # example: 31-12-2024
            except ValueError:
                try:
                    parsed = datetime.strptime(old_date, "%Y-%m-%d")  # already correct
                except ValueError:
                    print(f"Skipping invalid date for ID {row_id}: {old_date}")
                    continue

        new_date = parsed.strftime("%Y-%m-%d")
        cursor.execute(
            "UPDATE meeting_attendance SET meeting_date = ? WHERE id = ?",
            (new_date, row_id)
        )
        print(f"Updated ID {row_id}: {old_date} -> {new_date}")

    conn.commit()
    conn.close()
    print("Date formatting complete.")

if __name__ == "__main__":
    format_dates()
